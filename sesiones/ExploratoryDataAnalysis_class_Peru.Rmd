<br> 
<center><img src="http://i.imgur.com/tveTlt8.png" width="300"></center>

## Course: Estadística Para el Análisis Político II<br> Semestre 2017-II<br> 
### Prof. José Manuel Magallanes, PhD 
____
## **Exploración de Datos en R**
____

<a id='beginning'></a>

La exploración de datos tiene en cuenta:

* El tipo de escala en que estén los datos (dicotómica, politómica, etc.); y las combinaciones entre estas.
* La detección del comportamiento de los datos y su afinidad (o no) con algun modelo teórico.

Los contenidos ara esta sesión se organizan asi:

1. __AED Univariado__

* Categoricos

    * [Dicotomicos](#Dichotomous)
    * Politomicos
        * [No-Ordinal](#Nordinal)
        * [Ordinal](#Ordinal)

* Numéricos
    * [Conteos](#Counts)
    * [Mediciones](#Measurements) (ratio o intervalo)
    
2. __AED Bivariado__

* [Categorical - Categorical](#catcat) 
* [Categorical - Numerical](#catnum) 
* [Numerical - Numerical](#numnum) 

<a id='Dichotomous'></a> 

## <span style="color:blue"> Exploración de variables dicotómicas</span>

Carguemos la data:
```{r, eval=TRUE}
library(RCurl)
link='https://docs.google.com/spreadsheets/d/1bDMM5s3PDC5awrSkILFRPJMlQ0j95TtVxErvvNNOHPU/pub?gid=914658997&single=true&output=csv'
myCsv <- getURL(link)
namesOfCols=c('timeStamp','nombre','apellido','tipoCole','distritoNace','regionNace','edad','sexo', 'religion')
# parsing as csv
myData=read.csv(textConnection(myCsv),col.names=namesOfCols)
```

Aqui vemos como se comporta una dicotómica:

```{r, eval=TRUE}
table(myData$sexo)
```
De manera gráfica:

```{r, eval=TRUE}
toPlot=table(myData$sexo)
barplot(toPlot,col='lightblue',
        xlab='Sexo',
        ylab='Conteo de alumnos',
        main='Distribución de sexo en el aula')
```

Para verlo como porcentajes tenemos:

```{r, eval=TRUE}
prop.table(table(myData$sexo)) # como plotearias estos resultados?
```

Es util saber si la diferencia es significativa usando la prueba $\chi^2$ :
```{r, eval=TRUE}
distribution=table(myData$sexo)
chisq.test(distribution)
```
Un valor significativo del p-value (menor a 0.05) sugiere que hay diferencias (se rechaza que haya comportamiento uniforme).

En esta situación, podemos considerar que la moda es relevante:
```{r, eval=TRUE}
names(distribution[which.max(distribution)]) #asi se obtiene
```

[Inicio](#beginning)

______
<a id='Nordinal'></a>

## <span style="color:blue"> Exploración de variables categoricas No Ordinales</span>

Exploremos la Región de procedencia:

```{r, eval=TRUE}
table(myData$regionNace)
```
Hay dos Limas?

```{r,eval=TRUE}
# asumo que alguien escribió "Lima " (con algun espacio en blanco)
# así que mejor leo eliminando (stripping) los espacios en cada celda...
myData=read.csv(textConnection(myCsv),col.names=namesOfCols,stringsAsFactors =FALSE,strip.white = TRUE) 
# por que 'stringsAsFactors =FALSE'??
table(myData$regionNace)
```

Simbolos raros por el lenguaje español!...veamos:
```{r, eval=TRUE}
names(table(myData$regionNace))
```

Buscando la ubicación, cambiamos a lo que deseamos:
```{r, eval=TRUE}
# esto es un problema de 'encoding'
ancashBad=names(table(myData$regionNace))[1]
juninBad=names(table(myData$regionNace))[5]

myData$regionNace[myData$regionNace==ancashBad]='Ancash'
myData$regionNace[myData$regionNace==juninBad] ='Junin'
table(myData$regionNace)
```


Grafiquemos nuestra variable:

```{r, eval=TRUE}
toPlot=table(myData$regionNace)
barplot(toPlot,col='magenta',
        xlab='Region',
        ylab='Conteo de alumnos',
        main='Distribución de region de nacimiento en el aula',
        las=2)
```

Veamos la relevancia de la moda:

```{r, eval=TRUE}
distribution=table(myData$regionNace)
chisq.test(distribution)
```
El resultado sugiere que la moda es significativa; sin embargo, la técnica reporta que podría haber problemas en el resultado. Intentemos usar una simulación en la prueba:
```{r, eval=TRUE}
distribution=table(myData$regionNace)
chisq.test(distribution, simulate.p.value = T)
```


Lo anterior corrobora que hay una moda sobresaliente, la cual es:

```{r, eval=TRUE}
names(distribution[which.max(distribution)])
```

Pero si fuera el caso de religion:

```{r, eval=TRUE}
toPlot=table(myData$religion)
barplot(toPlot,col='magenta',
        xlab='Region',
        ylab='Conteo de alumnos',
        main='Distribución de region de nacimiento en el aula')
```

Dada la distribución de los valores no modales, es posible que el peso de la moda sea menor:

```{r, eval=TRUE}
distribution=table(myData$religion)
chisq.test(distribution)
```

Como sospechamos, la prueba no descarta que haya uniformidad.

Otra manera de ver la representatividad o dispersión de la moda es mediante el uso del [Gini Index](https://en.wikipedia.org/wiki/Gini_coefficient):
```{r, eval=TRUE}
library(DescTools)  # instalar antes!
myData$religion=factor(myData$religion)  # valores texto a categorico
Gini(as.numeric(myData$religion),na.rm = TRUE) # categorico a numerico
```

[Inicio](#beginning)

______


<a id='Ordinal'></a>

## <span style="color:blue"> Exploración de variables categoricas Ordinales</span>

Abramos nuestro archivo del _American National Election Studies Survey_ (ANES):
```{r, eval=TRUE}
library(haven)
varsOfInterest=c("libcpre_self","libcpo_self")
folder="data"
fileName="anes_timeseries_2012.sav"
fileToRead=file.path(folder,fileName)
dataSpss=read_sav(fileToRead)
dataSpssSub=as.data.frame(dataSpss)[varsOfInterest]
```

```{r,eval=TRUE}
barplot(table(dataSpssSub$libcpre_self),las=2)
```


```{r, eval=TRUE}
attr(dataSpssSub$libcpre_self,'labels')
```

```{r, eval=TRUE}
var=dataSpssSub$libcpre_self
dataSpssSub$libcpre_self=ifelse(var<0,NA,var)
```


```{r,eval=TRUE}
theTable=table(dataSpssSub$libcpre_self)
barplot(theTable,ylim = c(0, 2000))
```

Hay que transformar esta variable en ordinal:

```{r, eval=T}
dataSpssSub$libcpre_self=ordered(dataSpssSub$libcpre_self)
head(dataSpssSub$libcpre_self)
```

Mas detalle:
```{r, eval=T}
# Formatting:
theLabels=c('XLiberal','Liberal','algo_liberal','moderado',
            'algo_conservador','Conservador','XConservador')
dataSpssSub$libcpre_self=factor(dataSpssSub$libcpre_self,
                                levels = c(1:7),
                                labels=theLabels,
                                ordered=T)
levels(dataSpssSub$libcpre_self)
```

```{r, eval=TRUE}
library(DescTools) #install first! 
Median(dataSpssSub$libcpre_self,na.rm = T)
```
```{r, eval=TRUE}
# confirm:
cumsum(prop.table(table(dataSpssSub$libcpre_self)))
```


```{r, eval=TRUE}

Gini(dataSpssSub$libcpre_self,na.rm = T)
```

```{r, eval=TRUE}
Mode(dataSpssSub$libcpre_self,na.rm = T)
```

Ambos estadísticos coinciden, confirmando la simetria que se notaba en el gráfico de barras.

```{r, eval=TRUE}
boxplot(dataSpssSub$libcpre_self)
```
```{r, eval=TRUE}
library(ggplot2)
data=na.omit(dataSpssSub)
varToPlot=as.numeric(data$libcpre_self)
thePlot=ggplot(data, aes(x=1,y=varToPlot)) + geom_boxplot() 
thePlot
```
```{r, eval=TRUE}
thePlot = thePlot + coord_flip()
thePlot
```
```{r, eval=TRUE}
thePlot= thePlot + scale_y_continuous(labels= theLabels,breaks=1:7) 
thePlot
```
```{r, eval=TRUE}
thePlot + labs(title="Title", y = 'Respuestas', x=NULL) + scale_x_continuous(labels= NULL, breaks = NULL)
```



[Inicio](#beginning)

----

<a id='Counts'></a>


## <span style="color:red"> Explorando conteos</span>




```{r, eval=TRUE}
myData$edad
```


```{r, eval=TRUE}
library(stringr)

# preparar regular expression
regexp <- "[[:digit:]]+"

# procesando string
myData$edad=str_extract(myData$edad, regexp)
myData$edad=as.numeric(myData$edad)
myData$edad
```

```{r, eval=TRUE}
ggplot(myData, aes(edad)) + geom_bar()
```
```{r, eval=TRUE}
summary(myData$edad)
```

```{r, eval=TRUE}
ggplot(myData, aes(x = 1, y = edad)) + geom_boxplot() +coord_flip()
```

[Inicio](#beginning)

______

<a id='Measurements'></a>


## <span style="color:red"> Explorando mediciones</span>

```{r, eval=TRUE}
library(XML)
library(RCurl)


# URL
wiki="https://en.wikipedia.org/wiki/" 
link = "List_of_countries_by_GDP_(PPP)_per_capita" 

# Data
wikiLinkContents = getURL(paste0(wiki,link)) 
wikiTables = readHTMLTable(wikiLinkContents,
                           stringsAsFactors=FALSE)
```

```{r, eval=TRUE}
#list:
is.list(wikiTables)
# how many?
length(wikiTables)
```

Al visitar la web, nos damos cuenta la tabla de interés es la segunda:
```{r, eval=TRUE}
idx=wikiTables[[2]]
head(idx)
```


```{r, eval=TRUE}
names(idx)=c('rank','country','gdp')
idx$gdp=as.numeric(idx$gdp)
idx$gdp

```
```{r, eval=TRUE}
idx=wikiTables[[2]]
names(idx)=c('rank','country','gdp')
idx$gdp=as.numeric(gsub(",", "", idx$gdp))
idx$gdp
```

```{r, eval=TRUE}
ggplot(idx,aes(x=gdp)) + geom_histogram()
```


```{r, eval=TRUE}
ggplot(idx,aes(y=gdp,x=1)) + geom_boxplot() + coord_flip()
```
_____
<br></br>

####[VOLVER AL SILABO](https://politicaygobiernopucp.github.io/EstadisticaPoliticaGobiernoII/)